const{is:t,assign:n,keys:e}=Object,o=document,s=requestAnimationFrame,r=setTimeout,c=t=>"function"==typeof t,i=t=>"object"==typeof t,l=Array.isArray,u=(t,n)=>t[n],f=(t,n,e)=>t[n]=e,a=t=>{console.error(t)},h=t=>{try{return t()}catch(t){a(t)}},m=t=>{t.forEach(h),t.length=0},y=(n,o)=>{if(n===o)return!0;if(!i(n)||!i(o))return!1;if(l(n))return l(o)&&n.length===o.length&&n.every((n,e)=>t(n,o[e]));const s=e(n);return s.length===e(o).length&&s.every(e=>o.hasOwnProperty(e)&&t(n[e],o[e]))},d=()=>{const t=Symbol();return[n=>u(n,t),(n,e)=>f(n,t,e)]},[p,E]=d(),[x,b]=d(),[k,A]=d(),P=t=>k(t)||A(t,{}),R=(()=>{const[t,n]=d();let e=0;return o=>t(o)||n(o,"comp"+e++)})(),_=function(t){const n=k(this)[t.type];return n&&n.call(this,t,this)};class v extends HTMLElement{constructor(t){if(super(),this.t=t,this.o=null,this.s=[],this.i=[],this.l=[],this.u=0,!t)throw Error()}disconnectedCallback(){m(this.l)}}customElements.define("HS-WRAPPER".toLowerCase(),v);let w=0,H=null;const S=()=>{if(!H)throw Error("illegal context");return H},g=t=>{const n=S().s;return w>=n.length&&(n[w]=t()),n[w++]},j=t=>{const n=n=>void C(q(n.nodeName,[j(t)]),n);return b(n,t),n},T=(t,n={},e={})=>({h:t,m:n,p:e}),W=T(""),q=(t,e)=>{const o={},s={},r={},u=t=>{const n=c(t.h)?R(t.h):t.h,e=t.m.key,o=null!=e?n+"#"+e:n,i=o+":"+(r[o]=-~r[o]);s[i]=t},f=t=>{if(null!=t)if(c(t)){const n=x(t);n&&u(n)}else i(t)?l(t)?t.forEach(f):n(o,t):u(T("#text",{k:""+t}))};return e.forEach(f),T(t,o,s)},C=(t,s)=>{if(!s){const n=t.h;if("#text"===n)s=o.createTextNode("");else{const e=c(n)?new v(n):o.createElement(n),r=t.m.key;null!=r&&e.setAttribute("data-key",r),s=e}}if(c(t.h)){const n=((t,n)=>{t.o=n,t.u=0,w=0,H=t;try{return t.t(n.m,t)}catch(t){return a(t),[]}finally{H=null}})(s,t);t=q("HS-WRAPPER",[n])}const r=x(s)||W;if(r!==t){const o=r.m,l=t.m;if(s instanceof Element){for(const t of e(l)){if("key"===t)continue;const e=o[t],r=l[t];if(e!==r)if(t.startsWith("on")){const n=t.slice(2),o=c(r)?r:null,i=c(e)?e:null;P(s)[n]=o,i&&!o?s.removeEventListener(n,_):!i&&o&&s.addEventListener(n,_)}else t in s?"style"===t&&i(r)?n(u(s,t),r):f(s,t,r):null==r||!1===r?s.removeAttribute(t):s.setAttribute(t,r)}const a=r.p,h=t.p,m={};for(let t=s.firstChild;t;){const n=t.nextSibling,e=p(t);e&&a[e]&&h[e]?m[e]=t:s.removeChild(t),t=n}let y=s.firstChild;for(const t of e(h)){const n=C(h[t],m[t]);E(n,t),y!==n&&s.insertBefore(n,y),y=n.nextSibling}}else{const t=l.k||"";(o.k||"")!==t&&(s.nodeValue=t)}b(s,t)}return s instanceof v&&m(s.i),s},F=(t,...n)=>j(c(t)?T(t,n[0]):q(t.toUpperCase(),n)),L=(t,n)=>{const e=g(()=>[]);return y(n,e[0])||(e[0]=n,e[1]=t()),e[1]},M=(t,n)=>{const e=g(()=>{let t;const n=n=>{t&&(h(t),t=void 0),n&&(t=h(n))};return S().l.push(n),[void 0,n]});n&&y(n,e[0])||(e[0]=n,S().i.push(()=>e[1](t)))},O=n(F,{fold:(t,n)=>g(()=>{const e=S(),o=[c(t)?t():t,t=>{const r=n?n(o[0],t):t;o[0]!==r&&(o[0]=r,(t=>{!t.u&&t.o&&(t.u=s(()=>{t.u&&C(t.o,t)}))})(e))}];return o}),memo:L,post:M,side:(t,n)=>{M(()=>{let n;return r(()=>{n=h(t)}),()=>{r(()=>{n&&h(n)})}},n)},pure:t=>n=>L(()=>F(t,n),n),same:y});export{O as h};